$schema: https://azuremlschemas.azureedge.net/latest/pipelineJob.schema.json
type: pipeline

description: Train model with auto mpg data

display_name: auto-mpg-pipeline-example
experiment_name: auto-mpg-pipeline-example
jobs:

  prep_job:
    type: command
    inputs:
      data: 
          type: uri_folder 
          path: ./data
      test_train_ratio:
    outputs:
      train_data: 
        mode: upload
      test_data:
        mode: upload
    code: src/data_prep
    environment: azureml:AzureML-sklearn-1.0-ubuntu20.04-py38-cpu@latest
    compute: azureml:c002
    command: >-
      python prep.py 
      --data ${{inputs.data}} 
      --test_train_ratio ${{inputs.test_train_ratio}}
      --train_data ${{outputs.train_data}}
      --test_data ${{outputs.test_data}}
  
  train_job:
    type: command
    inputs:
      train_data: ${{parent.jobs.prep_job.outputs.train_data}}
      test_data: ${{parent.jobs.prep_job.outputs.test_data}}
      learning_rate: 
      registered_model_name:
    outputs:
      model: 
    code: src/train
    environment: azureml:AzureML-sklearn-1.0-ubuntu20.04-py38-cpu@latest
    compute: azureml:c002
    command: >-
      python train.py 
      --train_data ${{inputs.train_data}} 
      --test_data ${{inputs.test_data}}
      --learning_rate ${{inputs.learning_rate}} 
      --registered_model_name ${{inputs.registered_model_name}}
      --model ${{outputs.model}}
